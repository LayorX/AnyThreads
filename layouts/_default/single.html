{{ define "main" }}
<div class="container single-post-container">
    <div class="post-header-container">
        <!-- Header and ambient bar are now loaded globally in baseof.html -->
    </div>
    <div class="post-layout">
    <article class="post-content">
        <header class="post-header">
            <div class="post-meta">
                <span class="post-date">{{ .Date.Format "2006.01.02" }}</span>
                <div class="reading-time-post">
                    <span class="coffee-cups">
                        {{ $coffees := "" }}
                        {{ $maxCups := 5 }}
                        {{ $cupsToShow := .ReadingTime }}
                        {{ if gt .ReadingTime $maxCups }}
                            {{ $cupsToShow = $maxCups }}
                        {{ end }}
                        {{ range (seq $cupsToShow) }}
                            {{ $coffees = print $coffees "☕" }}
                        {{ end }}
                        {{ $coffees }}
                    </span>
                    <span>{{ .ReadingTime }} min read</span>
                </div>
            </div>
            <h1 class="post-title">{{ .Title }}</h1>
            {{ if .Params.subtitle }}
            <p class="post-subtitle">{{ .Params.subtitle }}</p>
            {{ end }}

            {{ if .Params.tags }}
            <div class="post-tags-header">
                {{ range .Params.tags }}
                <a href="{{ "/tags/" | absLangURL }}{{ . | urlize }}" class="post-tag">{{ . }}</a>
                {{ end }}
            </div>
            {{ end }}
        </header>
        <div class="post-body">
            {{ .Content }}
        </div>

        {{ $related := .Site.RegularPages.Related . | first 3 }}
        {{ with $related }}
        <div class="related-posts">
            <h3>Related Content</h3>
            <div class="related-grid">
                {{ range . }}
                <div class="related-post">
                    <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                    <div class="related-meta">
                        {{ .Date.Format "2006.01.02" }} •
                        {{ $coffees := "" }}
                        {{ $maxCups := 5 }}
                        {{ $cupsToShow := .ReadingTime }}
                        {{ if gt .ReadingTime $maxCups }}{{ $cupsToShow = $maxCups }}{{ end }}
                        {{ range (seq $cupsToShow) }}{{ $coffees = print $coffees "☕" }}{{ end }}
                        {{ $coffees }} {{ .ReadingTime }} min read
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <!-- Post Navigation (Prev/Next) -->
        <nav class="post-navigation">
            {{ with .PrevInSection }}
            <div class="nav-previous">
                <span class="nav-label">← Previous</span>
                <a href="{{ .Permalink }}" class="nav-title">{{ .Title }}</a>
            </div>
            {{ else }}
            <div></div>
            {{ end }}

            {{ with .NextInSection }}
            <div class="nav-next">
                <span class="nav-label">Next →</span>
                <a href="{{ .Permalink }}" class="nav-title">{{ .Title }}</a>
            </div>
            {{ else }}
            <div></div>
            {{ end }}
        </nav>
    </article>

    <aside class="sidebar">
        <nav class="toc">
            <h4>Contents</h4>
            <div id="toc-content">
                <!-- TOC will be generated by JavaScript -->
            </div>
        </nav>
    </aside>
    </div>
</div>
{{ end }}